;======================================================================================
; Map ported by ZombieFeyk. https://steamcommunity.com/id/zombiefeyk159753/
; DO NOT TOUCH ANYTHING THIS FIXES GAMEPLAY BUGS ON THE MAP
;======================================================================================


;===================================
; ReCreate Entity logic_case - The Boss Powers. In the next version this stripper will be useless (i guess).
;===================================

filter:
{
	"origin" "-8896 -12592 -8632"
	"targetname" "st3_boss_pattern_case"
	"classname" "logic_case"
	"hammerid" "57108"
}

add:
{
	"origin" "-8893 -12552 -8672"
	"targetname" "st3_boss_pattern_case"
	"classname" "logic_case"
	"hammerid" "57109"
	"OnCase01" "cmd,Command,say ***Get ready to hold down the W key***,0,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,0,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,1,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,2,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,2.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,3,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,1.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,3.25,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,6.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,3.75,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,4.75,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,4.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,4.25,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,4,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,5.75,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,5.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,5.25,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,6.75,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,3.5,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,6.25,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,6,-1"
	"OnCase01" "st3_b_push_maker,ForceSpawn,,7,-1"
	"OnCase01" "st3_b_push_tri,Enable,,3,-1"
	"OnCase01" "st3_b_push_tri,Disable,,7,-1"
	"OnCase02" "cmd,Command,say ***Get ready to hold down the S key***,0,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,7,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,6.75,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,6.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,6.25,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,6,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,5.75,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,5.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,5.25-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,4.75,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,4.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,4.25-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,4,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,3.75,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,3.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,3.25,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,3,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,2.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,2,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,1.5,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,1,-1"
	"OnCase02" "st3_b_grav_maker,ForceSpawn,,0,-1"
	"OnCase02" "st3_b_grav_tri,Disable,,7,-1"
	"OnCase02" "st3_b_grav_tri,Enable,,3,-1"
	"OnCase03" "cmd,Command,say ***Go to the platforms on both sides***,0,-1"
	"OnCase03" "st3_b_wt,Toggle,,0,-1"
	"OnCase03" "st3_wt_hurt,Enable,,5,-1"
	"OnCase03" "st3_wt_hurt,Disable,,5.1,-1"
	"OnCase03" "st3_b_start_fade_skyblue,Fade,,5,-1"
	"OnCase03" "cmd,Command,say ***RETURN***,6,-1"
	"OnCase03" "cmd,Command,say ***RETURN***,7,-1"
	"OnCase03" "cmd,Command,say ***RETURN***,8,-1"
	"OnCase03" "st3_b_wt,Toggle,,10,-1"
	"OnCase04" "cmd,Command,say ***LASER***,0,-1"
	"OnCase04" "cmd,Command,say ***Jump or Crouch***,1,-1"
	"OnCase04" "st3_b_laser_timer,Enable,,0.5,-1"
	"OnCase04" "st3_b_laser_timer,Disable,,9,-1"
	"OnCase05" "st3_b_beam_temp,ForceSpawn,,0,-1"
	"OnCase05" "st3_b_beam_temp,ForceSpawn,,3.5,-1"
	"OnCase05" "st3_b_beam_temp,ForceSpawn,,7,-1"
	"OnCase05" "cmd,Command,say ***BEAM***,0,-1"
	"OnCase06" "st2_boss_zway_fade,Fade,,0,-1"
	"OnCase06" "cmd,Command,say ***Zombies are coming***,0,-1"
	"OnCase06" "st3_b_zm_wt,Toggle,,0,-1"
	"OnCase06" "st3_b_zm_start_tele,Enable,,0.5,-1"
	"OnCase06" "st3_b_zm_start_tele,Disable,,9,-1"
	"OnCase06" "st3_b_zm_end_tele,Enable,,9.5,-1"
	"OnCase06" "st3_b_zm_end_tele,Disable,,11,-1"
	"OnCase06" "st3_b_zm_wt,Toggle,,9.6,-1"
	"OnCase07" "cmd,Command,say ***Watch out for Tesla***,0,-1"
	"OnCase07" "st3_b_tesla_timer,Enable,,0,-1"
	"OnCase07" "st3_b_tesla_timer,Disable,,7,-1"
	"OnCase08" "st3_b_smoke_temp,ForceSpawn,,0,-1"
	"OnCase08" "st3_b_smoke_temp,ForceSpawn,,4,-1"
}

;===================================
; Fix Last Teleport (Level 1)
;===================================

filter:
{
	"model" "*272"
	"targetname" "final_tele_hm"
	"classname" "trigger_teleport"
	"spawnflags" "4097"
	"origin" "1536 -3072 214"
	"hammerid" "7198"
}

add:
{
	"model" "*272"
	"targetname" "final_tele_hm"
	"target" "final_tele_des"
	"StartDisabled" "0"
	"spawnflags" "4097"
	"origin" "1536 -3072 202"
	"filtername" "tele_human"
	"classname" "trigger_teleport"
	"hammerid" "7120"
	"OnStartTouch" "afk_5,Enable,,8,-1"
}

;===================================
; Fix forgotten trigger_once (Level 3)
;===================================

filter:
{
	"model" "*124"
	"targetname" "st3_move1_tri"
	"spawnflags" "4097"
	"origin" "-3328 -7968 -6528"
	"classname" "trigger_once"
	"hammerid" "45905"
}

add:
{
	"model" "*124"
	"targetname" "st3_move1_tri"
	"spawnflags" "4097"
	"origin" "-3328 -7968 -6520"
	"classname" "trigger_once"
	"hammerid" "45950"
	"OnStartTouch" "st3_sc1,Break,0,1"
	"OnStartTouch" "cmd,Command,say ***25 seconds***,0,1"
	"OnStartTouch" "cmd,Command,say ***10 seconds***,15,1"
	"OnStartTouch" "cmd,Command,say ***5 seconds***,20,1"
	"OnStartTouch" "st3_move1,Open,,25,1"
}

;===================================
; Fix forgotten boss add hp counter (Level 3)
;===================================

modify:
{
	match:
	{
		"classname" "trigger_teleport"
		"targetname" "st3_b_start_tele_hm"
	}
	insert:
	{
		"OnStartTouch" "!activator,AddOutput,health 200,0,-1"
		"OnStartTouch" "st3_boss_hp_counter,Add,450,0,-1"
	}
}

;===================================
; Fix Last Teleport after boss. (Level 2)
;===================================

modify:
{
	match:
	{
		"classname" "logic_relay"
		"targetname" "st2_escape_relay"
	}
	delete:
	{
		"OnTrigger" "st2_escape_tele1_des,AddOutput,origin 2048 14912 1632,0,-1"
		"OnTrigger" "st2_escape_tele2_des,AddOutput,origin 2048 12832 1632,0,-1"
		"OnTrigger" "st2_afk6,Enable,,166,0,-1"
		"OnTrigger" "cmd,Command,say ***5 seconds,110,-1"
	}
	insert:
	{
		"OnTrigger" "st2_escape_tele2_des,AddOutput,origin 2048 12832 1632,120,-1"
		"OnTrigger" "st2_escape_tele2_des,AddOutput,origin 2048 14912 1632,120,-1"
		"OnTrigger" "st2_afk6,Enable,,121,-1"
		"OnTrigger" "cmd,Command,say ***5 seconds***,110,-1"
	}
}

;===================================
; Replace Origin Add Boss Counter (Level 2)
;===================================

modify:
{
	match:
	{
		"classname" "trigger_multiple"
		"targetname" "st2_boss_hp_counter"
	}
	replace:
	{
		"origin" "-14336 10192 320"
	}
}

;===================================
; Reduce Timer to Enable trigger_multiple Add Boss Counter (Level 2)
;===================================

modify:
{
	match:
	{
		"classname" "trigger_once"
		"origin" "-14336 9280 336"
	}
	delete:
	{
		"OnStartTouch" "st2_boss_hp_counter,Enable,,10,1"
	}
	insert:
	{
		"OnStartTouch" "st2_boss_hp_counter,Enable,,1,1"
	}
}

;===================================
; Replace Up Origin Laser Boss Attack (Level 2)
;===================================

modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "st2_boss_upla"
	}
	replace:
	{
		"origin" "-14336 11744 324"
	}
}

modify:
{
	match:
	{
		"classname" "trigger_hurt"
		"targetname" "st2_boss_upla_hurt"
	}
	replace:
	{
		"origin" "-14336 11728 324"
	}
}

;===================================
; Fix Force AFK Teleport Zombies after triggering
;===================================

modify:
{
	match:
	{
		"targetname" "st3_door2_tri"
		"classname" "trigger_once"
	}
	delete:
	{
		"OnStartTouch" "st3_afk1,Enable,,0,-1"
	}
	insert:
	{
		"OnStartTouch" "st3_afk1,Enable,,30,1"
	}
}

;===================================
; Replace origin High Laser
;===================================

modify:
{
	match:
	{
		"classname" "func_movelinear"
		"targetname" "st2_boss_upla"
	}
	replace:
	{
		"origin" "-14336 11744 312"
	}
}
